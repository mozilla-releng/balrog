---
  title: App Release Blob (V6)
  type: object
  required:
    - name
    - schema_version
    - hashFunction
  additionalProperties: false
  properties:
    name:
      type: string
      description: Human readable identifier
      minLength: 1
      maxLength: 100
    product:
      type: string
      description: The product that the blob is associated to
      minLength: 1
      maxLength: 100
    schema_version:
      type: number
      description: Blob identifier number
      enum:
        - 6
    hashFunction:
      type: string
      description: Hash function of files pointed at (returned in responses generated by this Blob).
    appVersion:
      type: string
      description: The version of the application represented by this Blob.
    displayVersion:
      type: string
      description: The displayVersion to return with the update. Generally, the client will show this in the UI. If set, the displayVersion at the locale level takes priority.
    detailsUrl:
      type: string
      description: An URL string to a web page with more information about this release. %LOCALE% may be used, which will be substituted with the locale of the update request.
    actions:
      type: string
      description: A space separated list of actions to be passed to the client. Balrog has no special knowledge of these, merely passes them along to the client. Mozilla bugs 459972 and 549969 have additional background on this.
    openURL:
      type: string
      description: An URL to open after the update is applied, if "openURL" is specified as an action.
    notificationURL:
      type: string
      description: An URL to open if the notification bar update message is clicked. Only relevant if "showNotification" is specified as an action.
    alertURL:
      type: string
      description: The URL to open if the "update available" alert is clicked. Only relevant if "showAlert" is specified as an action.
    showPrompt:
      type: boolean
      description: Whether or not to show the update prompt (a pop up window).
    showNeverForVersion:
      type: boolean
      description: Whether or not to show the "No Thanks" button in the update prompt.
    promptWaitTime:
      type: number
      description: The number of seconds to wait before showing the dialog which prompts users to restart, overrides the in-app preference
    # Top level fileUrls are useful primarily for release style builds,
    # where the URLs are predictable and only vary by locale and platform.
    # It"s worth noting that while we normally serve different channels
    # through different fileUrls (eg, ftp.mozilla.org vs. download.mozilla.org),
    # each platform+locale combination is expected to receive the same
    # MAR contents regardless of channel. As of yet there is no way to
    # specify different metadata for different channels so doing anything
    # other than above will result in MAR verification failures on the client.
    fileUrls:
      type: object
      additionalProperties: false
      description: Key/value pairs where the key is a platform name (aka Build Target) and the values are the platform specific details.
      patternProperties:
        ^.+$:
          type: object
          additionalProperties: false
          description: Key/value pairs whose keys are either partials or completes and values are details for that update type.
          patternProperties:
            ^(partials|completes)$:
              type: object
              additionalProperties: false
              description: Key/value pairs whose keys are the name of a release (or * as a catch-all) and values are an URL of the MAR for that channel+update type+release.
              patternProperties:
                ^.+$:
                  type: string
    platforms:
      type: object
      additionalProperties: false
      description: Key/value pairs whose keys are the names of platforms (aka Build Targets) and values are platform-specific update details.
      patternProperties:
        ^.+$:
          oneOf:
            -
              type: object
              required:
                - alias
              properties:
                alias:
                  type: string
                  description: Platform to look for file details in instead of this one. Must match another existing platform name.
            -
              type: object
              additionalProperties: false
              properties:
                buildID:
                  oneOf:
                    -
                      type: string
                      description: The buildID to serve for this platform"s updates. Overridden by buildID at the locale level if present.
                      pattern: ^[0-9]*$
                    -
                      type: number
                      description: The buildID to serve for this platform"s updates. Overridden by buildID at the locale level if present.
                      pattern: ^[0-9]*$
                OS_BOUNCER:
                  type: string
                  description: The value to use when substituing %OS_BOUNCER% in file URLs. See top-level fileUrls for additional detail.
                OS_FTP:
                  type: string
                  description: The value to use when substituing %OS_FTP% in file URLs. See top-level fileUrls for additional detail.
                locales:
                  type: object
                  additionalProperties: false
                  description: Key/value pairs whose keys are the name of locales and values are locale-specific update details.
                  patternProperties:
                    ^.+$:
                      type: object
                      additionalProperties: false
                      properties:
                        isOSUpdate:
                          type: boolean
                          description: When true, instructs the client to reboot to apply this update. Only relevant for FirefoxOS.
                        buildID:
                          oneOf:
                            -
                              type: string
                              description: The buildID to serve for this locale"s updates. Overrides the platform-level buildID
                              pattern: ^[0-9]*$
                            -
                              type: number
                              description: The buildID to serve for this locale"s updates. Overrides the platform-level buildID
                              pattern: ^[0-9]*$
                        appVersion:
                          type: string
                          description: The version of the application represented by this Blob. If set, the locale level version overrides this one.
                        displayVersion:
                          type: string
                          description: The displayVersion to return with the update. Generally, the client will show this in the UI. If set, the displayVersion at the locale level takes priority. If set, the locale level version overrides this one.
                        # Using lists instead of dicts for multiple updates
                        # gives us a way to reduce load a bit. As this is
                        # iterated over, each "from" release is looked up
                        # in the database. If the "from" releases that we
                        # we expect to be the most common are earlier in the
                        # list, we can avoid looking up every single entry.
                        # The server doesn't know anything about which order is
                        # best, so we assume the client will make the right
                        # decision about this.
                        partials:
                          type: array
                          items:
                            type: object
                            required:
                              - filesize
                              - from
                              - hashValue
                            additionalProperties: false
                            description: A list of available partial updates for this platform+locale. Order is significant here, in that a database query is required to determine whether or not the partial is appropriate for an incoming request. For best performance, this list should be organized from most common to least common partial.
                            properties:
                              filesize:
                                oneOf:
                                  -
                                    type: number
                                    description: The filesize of this partial update
                                    pattern: ^[0-9]*$
                                  -
                                    type: string
                                    description: The filesize of this partial update
                                    pattern: ^[0-9]*$
                              from:
                                type: string
                                description: The release this partial update can be applied to. Should match another release in Balrog"s database.
                              hashValue:
                                type: string
                                description: The hash value of this partial update, calculated using the hashFunction specified at the top level.
                              fileUrl:
                                type: string
                                description: The URL to this partial update. If specified, overrides anything set in the top level fileUrls.
                                format: uri
                        completes:
                          type: array
                          items:
                            type: object
                            required:
                              - filesize
                              - from
                              - hashValue
                            additionalProperties: false
                            properties:
                              filesize:
                                oneOf:
                                  -
                                    type: number
                                    description: The filesize of this complete update
                                    pattern: ^[0-9]*$
                                  -
                                    type: string
                                    description: The filesize of this complete update
                                    pattern: ^[0-9]*$
                              from:
                                type: string
                                description: The release this partial update can be applied to. Should match another release in Balrog"s database.
                              hashValue:
                                type: string
                                description: The hash value of this partial update, calculated using the hashFunction specified at the top level.
                              fileUrl:
                                type: string
                                description: The URL to this partial update. If specified, overrides anything set in the top level fileUrls.
                                format: uri
