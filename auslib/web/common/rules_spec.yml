paths:
  /rules:
    get:
      operationId: "auslib.web.common.rules.get_rules"
      description: ""
      produces: ["application/json"]
      responses:
        200:
          description: ""
          schema:
            $ref: "#/definitions/RulesWrapper"

  /rules/{id_or_alias}:
    get:
      operationId: "auslib.web.common.rules.get_rule"
      description: ""
      produces: ["application/json"]
      parameters:
        - name: id_or_alias
          in: path
          required: true
          type: string
      responses:
        200:
          description: ""
          schema:
            $ref: "#/definitions/Rule"

  /rules/{rule_id}/revisions:
    get:
      operationId: "auslib.web.common.rules.get_rule_history"
      description: ""
      produces: ["application/json"]
      parameters:
        - name: rule_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: ""
          schema:
            $ref: "#/definitions/RuleHistoryWrapper"

definitions:
  Rule:
    type: object
    properties:
      rule_id:
        type: integer
        format: int32
      alias:
        type: ["string", "null"]
      priority:
        type: ["integer", "null"]
        format: int32
      mapping:
        type: ["string", "null"]
      fallbackMapping:
        type: ["string", "null"]
      backgroundRate:
        type: ["integer", "null"]
        format: int32
      update_type:
        type: string
      product:
        type: ["string", "null"]
      version:
        type: ["string", "null"]
      channel:
        type: ["string", "null"]
      buildTarget:
        type: ["string", "null"]
      buildID:
        type: ["string", "null"]
      locale:
        type: ["string", "null"]
      osVersion:
        type: ["string", "null"]
      systemCapabilities:
        type: ["string", "null"]
      distribution:
        type: ["string", "null"]
      distVersion:
        type: ["string", "null"]
      headerArchitecture:
        type: ["string", "null"]
      comment:
        type: ["string", "null"]

  RuleHistory:
    allOf:
    - $ref: "#/definitions/Rule"
    - type: object
    properties:
      change_id:
        type: integer
        format: int32
      changed_by:
        type: string
      timestamp:
        type: integer
        format: int64

  RulesWrapper:
    type: object
    properties:
      count:
        type: integer
        format: int32
      rules:
        type: array
        items:
          $ref: "#/definitions/Rule"

  RuleHistoryWrapper:
    type: object
    properties:
      count:
        type: integer
        format: int32
      rules:
        items:
          $ref: "#/definitions/RuleHistory"
